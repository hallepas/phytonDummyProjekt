{% extends "base.html" %}

{% block content %}
    <h2>Intelligente Einkaufsliste ğŸ›’</h2>

    <div class="panel panel-default" style="margin-top: 20px;">
        <div class="panel-body">
            <p>
                Gib die Zutaten ein, die du bereits zu Hause hast (kommagetrennt). 
                Die App zeigt dir alle passenden Rezepte, sortiert nach den meisten Ãœbereinstimmungen, mit der Einkaufsliste fÃ¼r fehlende Zutaten.
            </p>
            <form action="{{ url_for('einkaufsliste') }}" method="POST">
                <div class="form-group">
                    <label for="zutaten">Vorhandene Zutaten</label>
                    <textarea id="zutaten" name="zutaten" class="form-control" rows="3" 
                              placeholder="z.B. Tomaten, Zwiebeln, Knoblauch, OlivenÃ¶l" required>{{ vorhandene_zutaten }}</textarea>
                    <p class="help-block">Trenne die Zutaten mit Komma.</p>
                </div>
                <button type="submit" class="btn btn-success">Passende Rezepte finden</button>
            </form>
        </div>
    </div>

    {% if matched_rezepte %}
        <div style="margin-top: 30px;">
            <h3>Passende Rezepte ({{ matched_rezepte|length }})</h3>
            <p class="text-muted">Sortiert nach Anzahl vorhandener Zutaten</p>

            {% for match in matched_rezepte %}
                <div class="panel {% if match.match_percentage >= 80 %}panel-success{% elif match.match_percentage >= 50 %}panel-info{% else %}panel-warning{% endif %}" style="margin-top: 20px;">
                    <div class="panel-heading">
                        <h4 class="panel-title" style="margin: 0;">
                            <a href="{{ url_for('rezept_detail', rezept_id=match.rezept.id) }}" style="color: inherit; text-decoration: none;">
                                {{ match.rezept.name }}
                            </a>
                            <span class="pull-right">
                                <span class="label {% if match.match_percentage >= 80 %}label-success{% elif match.match_percentage >= 50 %}label-info{% else %}label-warning{% endif %}">
                                    {{ match.match_count }}/{{ match.total_count }} Zutaten ({{ "%.0f"|format(match.match_percentage) }}%)
                                </span>
                            </span>
                        </h4>
                    </div>
                    <div class="panel-body">
                        {% if match.rezept.description %}
                            <p><em>{{ match.rezept.description }}</em></p>
                        {% endif %}

                        <div class="row">
                            <div class="col-md-6">
                                <h5 style="color: green;">âœ“ Vorhandene Zutaten ({{ match.match_count }})</h5>
                                <ul style="list-style: none; padding-left: 0;">
                                    {% for zutat in match.matching_zutaten %}
                                        <li style="color: green;">
                                            âœ“
                                            {% if zutat.number %}{{ zutat.number }}{% endif %}
                                            {% if zutat.einheit %}{{ zutat.einheit }}{% endif %}
                                            {{ zutat.name }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>

                            <div class="col-md-6">
                                <h5 style="color: #d9534f;">ğŸ“ Einkaufsliste ({{ match.missing_zutaten|length }})</h5>
                                {% if match.missing_zutaten %}
                                    <ul style="list-style: none; padding-left: 0;">
                                        {% for zutat in match.missing_zutaten %}
                                            <li style="color: #d9534f;">
                                                âœ—
                                                {% if zutat.number %}{{ zutat.number }}{% endif %}
                                                {% if zutat.einheit %}{{ zutat.einheit }}{% endif %}
                                                <strong>{{ zutat.name }}</strong>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <p style="color: green;">Alle Zutaten vorhanden! ğŸ‰</p>
                                {% endif %}
                            </div>
                        </div>

                        <div style="margin-top: 10px;">
                            <a href="{{ url_for('rezept_detail', rezept_id=match.rezept.id) }}" class="btn btn-sm btn-primary">
                                Zum Rezept
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% elif vorhandene_zutaten %}
        <div class="alert alert-warning" style="margin-top: 30px;">
            <strong>Keine passenden Rezepte gefunden.</strong>
            <p>Versuche es mit anderen Zutaten oder fÃ¼ge neue Rezepte hinzu.</p>
        </div>
    {% endif %}
{% endblock %}
